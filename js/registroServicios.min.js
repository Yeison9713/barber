var servicios={},barberos={};function guardarRegistro(){if(barberoSel=$('select[name="barberos"] option:selected').val(),parametros={titulo:"¡Advertencia!",href:"#registrarServicios",tipo:"advertencia",mensaje:""},0==barberoSel)parametros.mensaje="Debes seleccionar un barbero",alerta(parametros);else if($("#detalleRegistro").find("tr").length-1==0)parametros.mensaje="Debes agregar al menos un servicio",alerta(parametros);else{for(var e=[],r=$("#detalleRegistro").find("tr").length-1,a=$('select[name="barberos"] option:selected').val(),t=0;t<r;t++){var i=$("#detalleRegistro").find("tr")[t+1];servicioTemp=$(i).find("td")[0],valorTemp=$(i).find("td a.valorServicioItm")[0];var o={servicio:getValServDescrip($(servicioTemp).html())[0].idServicio,valor:numeral($(valorTemp).html()).value()};e.push(o)}var s=JSON.stringify(e);$.ajax({async:!0,beforeSend:function(){parametros={titulo:"Procesando solicitud",tipo:"loader",mensaje:'<div class="loader-spinner"></div>'},alerta(parametros)},type:"POST",url:"http://80.211.145.146/barber/inc/registrarServicio.php",data:"item="+s+"&barbero="+a,dataType:"html",success:function(e){$(".alerta").remove();var r=e.split("|");"0"==r[0]?(alertCorrecto.href="reload",alertCorrecto.mensaje=r[1],alerta(alertCorrecto)):"-1"==r[0]?(alertError.mensaje="<b>Descripción: </b>"+r[1],alerta(alertError)):(alertError.mensaje="<b>Descripción: </b>"+r,alerta(alertError))}})}}function cargarServicios(e){var r=$.parseJSON(e);if(r.codigo_error)alertError.mensaje="<b>Descripción: </b>"+r.descripcion+"<br><br> Debes registrar al menos un servicio para poder facturar.",alerta(alertError);else for(servicios=r,$i=0;$i<servicios.length;$i++)$('select[name="servicios"]').append('<option value="'+servicios[$i].idServicio+'">'+servicios[$i].Descripcion+"</option>"),$('select[name="servicios"').selectric("refresh")}function cargarBarberos(e){var r=$.parseJSON(e);if(r.codigo_error)alertError.mensaje="<b>Descripción: </b>"+r.descripcion+"<br><br> Debes registrar barberos para poder facturar un servicio.",alerta(alertError);else for(barberos=r,$i=0;$i<barberos.length;$i++)$('select[name="barberos"]').append('<option value="'+barberos[$i].idBarbero+'">'+barberos[$i].Descripcion+"</option>"),$('select[name="barberos"').selectric("refresh")}function agregarItem(){if(parametros={titulo:"Advertencia",href:"#registrarServicios",tipo:"advertencia",mensaje:""},0==$('select[name="servicios"] option:selected').val())parametros.mensaje="Debes seleccionar un servicio",alerta(parametros);else if($('input[name="valorServicio"]').val().length<1)parametros.mensaje="Ingresa un valor para el servicio",alerta(parametros);else{var e=numeral($('input[name="valorServicio"]').val()).format("0,0");$("<tr><td>"+$('select[name="servicios"] option:selected').html()+'</td><td>$ <a class="valorServicioItm">'+e+'</a></td><td class="td-button"><button type="button" class="btn-circle btn-blanco eliminarItem"><i class="material-icons">delete</i></button></td></tr>').appendTo($("#detalleRegistro tbody")),calcularTotal("sumar",e),$('select[name="servicios"').prop("selectedIndex",0).selectric("refresh"),$('input[name="valorServicio"]').val(""),$(".eliminarItem").unbind("click").click(eliminarItem)}}function eliminarItem(){$(this).closest("tr").hide("fade","fast",function(){$(this).closest("tr").remove()}),calcularTotal("restar",$(this).closest("tr").find(".valorServicioItm").html())}function calcularTotal(e,r){var a=numeral($("#valorTotal").html()).value(),t=numeral(r).value();if("restar"==e)var i=parseInt(a)-parseInt(t);else if("sumar"==e)i=parseInt(a)+parseInt(t);$("#valorTotal").html(numeral(i).format("0,0"))}function getValServCode(e){return servicios.filter(function(r){return r.idServicio==e})}function getValServDescrip(e){return servicios.filter(function(r){return r.Descripcion==e})}function ajax(e,r,a){return $.ajax({async:!0,type:"POST",url:e,data:r,dataType:"html",success:function(e){a(e)}})}function cargarFecha(){var e=new Date,r=e.getDate(),a=e.getMonth()+1,t=e.getFullYear();r<10&&(r="0"+r),a<10&&(a="0"+a),e=r+"/"+a+"/"+t,$("#fechaActual").html(e)}alertError={titulo:"¡Ha ocurrido un error!",href:"#registrarServicios",tipo:"error",mensaje:""},alertCorrecto={titulo:"¡Correcto!",href:"#registrarServicios",tipo:"correcto",mensaje:""},$(document).ready(function(){ajax("http://localhost/barber/inc/consultas.php","tipo=Barberos",cargarBarberos),ajax("http://localhost/barber/inc/consultas.php","tipo=Servicios",cargarServicios),cargarFecha(),$('select[name="servicios"]').change(function(){if(idServicio=$('select[name="servicios"] option:selected').val(),0==idServicio)$('input[name="valorServicio"]').val("");else{var e=getValServCode(idServicio);$('input[name="valorServicio"]').val(e[0].valorSugerido)}}),$("#addItmSrv").click(agregarItem),$("#guardar").click(guardarRegistro),$(".number").number(!0)});